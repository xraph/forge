name: Release Please

on:
  push:
    branches:
      - main

permissions:
  contents: write
  pull-requests: write

jobs:
  release-please:
    runs-on: ubuntu-latest
    steps:
      - uses: googleapis/release-please-action@v4
        id: release
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Log release outputs
        if: always()
        run: |
          echo "releases_created=${{ steps.release.outputs.releases_created }}"
          echo "prs_created=${{ steps.release.outputs.prs_created }}"

          # release-please outputs are JSON when multiple packages are configured.
          # Individual tags are pushed automatically, which triggers the release.yml workflow.

          cat >> "$GITHUB_STEP_SUMMARY" << 'HEADER'
          # Release Please
          HEADER

          if [ "${{ steps.release.outputs.releases_created }}" = "true" ]; then
            echo "" >> "$GITHUB_STEP_SUMMARY"
            echo "Releases were created. The **Release** workflow will run for each new tag." >> "$GITHUB_STEP_SUMMARY"
          elif [ "${{ steps.release.outputs.prs_created }}" = "true" ]; then
            echo "" >> "$GITHUB_STEP_SUMMARY"
            echo "Release PRs have been created or updated. Review and merge to trigger releases." >> "$GITHUB_STEP_SUMMARY"
          else
            echo "" >> "$GITHUB_STEP_SUMMARY"
            echo "No releasable changes found since the last release." >> "$GITHUB_STEP_SUMMARY"
          fi
