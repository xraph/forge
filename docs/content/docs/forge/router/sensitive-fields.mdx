---
title: Sensitive Field Cleaning
description: Clean sensitive data from API responses using struct tags
---

# Sensitive Field Cleaning

Forge provides a `sensitive` struct tag to mark fields that should be cleaned from JSON responses. This is useful for ensuring sensitive data like passwords, API keys, and tokens are not accidentally exposed in API responses.

## Overview

The sensitive field cleaning feature:

- Uses struct tags to mark sensitive fields
- Is **opt-in per route** via `WithSensitiveFieldCleaning()`
- Supports multiple cleaning modes: zero value, redact, or custom mask
- Works with nested structs, slices, arrays, and maps

## Tag Syntax

```go
type UserResponse struct {
    ID       string `json:"id"`
    Email    string `json:"email"`
    Password string `json:"password" sensitive:"true"`     // → "" (zero value)
    APIKey   string `json:"api_key" sensitive:"redact"`    // → "[REDACTED]"
    Token    string `json:"token" sensitive:"mask:***"`    // → "***"
}
```

### Sensitive Tag Options

| Tag Value | Behavior | Example Output |
|-----------|----------|----------------|
| `sensitive:"true"` | Set to zero value | `""` for strings, `0` for numbers, `nil` for pointers |
| `sensitive:"redact"` | Replace with "[REDACTED]" | `"[REDACTED]"` |
| `sensitive:"mask:***"` | Replace with custom mask | `"***"` |

## Usage

### Enable Per Route

Sensitive field cleaning must be explicitly enabled per route using `WithSensitiveFieldCleaning()`:

```go
// This route will clean sensitive fields
router.GET("/users/:id", getUserHandler,
    forge.WithSensitiveFieldCleaning(),
)

// This route will NOT clean sensitive fields
router.GET("/admin/users/:id", getAdminUserHandler)
```

### Complete Example

```go
package main

import (
    "github.com/xraph/forge"
)

type CreateUserRequest struct {
    Email    string `json:"email"`
    Password string `json:"password"`
}

type UserResponse struct {
    ID        string `json:"id"`
    Email     string `json:"email"`
    Password  string `json:"password" sensitive:"true"`      // Will be cleaned
    AuthToken string `json:"auth_token" sensitive:"redact"`  // Will be [REDACTED]
    APIKey    string `json:"api_key" sensitive:"mask:sk-***"` // Will be sk-***
}

func main() {
    app := forge.New()
    router := app.Router()

    // Create user - returns user with cleaned sensitive fields
    router.POST("/users", func(ctx forge.Context, req *CreateUserRequest) (*UserResponse, error) {
        // Create user in database...
        user := &UserResponse{
            ID:        "usr_123",
            Email:     req.Email,
            Password:  req.Password,  // Original password
            AuthToken: "secret-token",
            APIKey:    "sk-live-abc123",
        }
        return user, nil
    }, forge.WithSensitiveFieldCleaning())

    app.Run(":8080")
}
```

**Response with sensitive cleaning enabled:**
```json
{
    "id": "usr_123",
    "email": "user@example.com",
    "password": "",
    "auth_token": "[REDACTED]",
    "api_key": "sk-***"
}
```

## Nested Structs

Sensitive field cleaning works recursively through nested structures:

```go
type Credentials struct {
    Username string `json:"username"`
    Password string `json:"password" sensitive:"true"`
    MFACode  string `json:"mfa_code" sensitive:"redact"`
}

type UserWithCredentials struct {
    ID    string      `json:"id"`
    Name  string      `json:"name"`
    Creds Credentials `json:"credentials"` // Nested struct
}

router.GET("/user", func(ctx forge.Context) error {
    return ctx.JSON(200, &UserWithCredentials{
        ID:   "123",
        Name: "John",
        Creds: Credentials{
            Username: "john",
            Password: "secret",  // Will be cleaned
            MFACode:  "123456",  // Will be [REDACTED]
        },
    })
}, forge.WithSensitiveFieldCleaning())
```

**Response:**
```json
{
    "id": "123",
    "name": "John",
    "credentials": {
        "username": "john",
        "password": "",
        "mfa_code": "[REDACTED]"
    }
}
```

## Slices and Arrays

Sensitive fields are also cleaned in slices and arrays:

```go
type Token struct {
    ID    string `json:"id"`
    Value string `json:"value" sensitive:"mask:****"`
}

router.GET("/tokens", func(ctx forge.Context) error {
    return ctx.JSON(200, []Token{
        {ID: "1", Value: "secret1"},
        {ID: "2", Value: "secret2"},
    })
}, forge.WithSensitiveFieldCleaning())
```

**Response:**
```json
[
    {"id": "1", "value": "****"},
    {"id": "2", "value": "****"}
]
```

## Pointer Fields

Sensitive tags work with pointer fields:

```go
type Config struct {
    PublicKey  string  `json:"public_key"`
    PrivateKey *string `json:"private_key" sensitive:"true"`  // Will be nil
    Secret     *string `json:"secret" sensitive:"redact"`     // Will be "[REDACTED]"
}
```

For pointer fields:
- `sensitive:"true"` sets the pointer to `nil`
- `sensitive:"redact"` sets the pointer to `"[REDACTED]"` (for string pointers)
- `sensitive:"mask:xxx"` sets the pointer to the mask value (for string pointers)

## Non-String Types

For non-string types (int, float, bool, etc.), the sensitive tag always sets them to their zero value:

```go
type SecureConfig struct {
    VisibleCount int `json:"visible_count"`
    SecretCount  int `json:"secret_count" sensitive:"true"`  // Will be 0
    SecretFloat  float64 `json:"secret_float" sensitive:"redact"` // Will be 0
}
```

The `redact` and `mask` modes only produce their text values for string types. For other types, they fall back to zero values.

## Response Headers

Sensitive field cleaning works alongside other response features like header tags:

```go
type ResponseWithHeaders struct {
    CacheControl string `header:"Cache-Control"`
    Data         string `json:"data"`
    Secret       string `json:"secret" sensitive:"redact"`
}

router.GET("/resource", func(ctx forge.Context) error {
    return ctx.JSON(200, &ResponseWithHeaders{
        CacheControl: "no-cache",
        Data:         "public data",
        Secret:       "sensitive data",
    })
}, forge.WithSensitiveFieldCleaning())
```

Both the header will be set and the sensitive field will be cleaned.

## Best Practices

### 1. Always Use for User-Facing APIs

Enable sensitive field cleaning on all routes that return user data:

```go
// Public API routes - always clean sensitive fields
publicAPI := router.Group("/api/v1")
publicAPI.GET("/users/:id", getUser, forge.WithSensitiveFieldCleaning())
publicAPI.GET("/profile", getProfile, forge.WithSensitiveFieldCleaning())
```

### 2. Use Different Modes Appropriately

- Use `sensitive:"true"` for fields that should be completely hidden
- Use `sensitive:"redact"` when you want to indicate a field exists but is hidden
- Use `sensitive:"mask:xxx"` to show a partial or placeholder value

### 3. Tag at the DTO Level

Apply sensitive tags to your response DTOs, not your domain models:

```go
// Domain model - no sensitive tags
type User struct {
    ID       string
    Email    string
    Password string
}

// Response DTO - with sensitive tags
type UserResponse struct {
    ID       string `json:"id"`
    Email    string `json:"email"`
    Password string `json:"password" sensitive:"true"` // Never expose password
}
```

### 4. Consider Logging

Remember that sensitive field cleaning only affects HTTP responses. Be careful about logging sensitive data:

```go
func handler(ctx forge.Context) error {
    user := getUserFromDB()
    
    // BAD: Logging sensitive data
    log.Printf("User: %+v", user)
    
    // GOOD: Log only non-sensitive fields
    log.Printf("User ID: %s, Email: %s", user.ID, user.Email)
    
    return ctx.JSON(200, user)
}
```

## Route Inspection

You can check if a route has sensitive field cleaning enabled:

```go
routes := router.Routes()
for _, route := range routes {
    if route.SensitiveFieldCleaning {
        fmt.Printf("Route %s %s has sensitive field cleaning enabled\n", 
            route.Method, route.Path)
    }
}
```

## Related Features

- [Response Headers](/docs/forge/router/response-headers) - Set response headers via struct tags
- [Body Tag](/docs/forge/router/body-tag) - Unwrap response body fields
- [Optional Tag](/docs/forge/router/optional-tag) - Mark fields as optional in schemas

